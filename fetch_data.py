# -*- coding: utf-8 -*-
"""fetch_data.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ALFpLyIJHOsk2FmJZ_v7mwgeiA4TQJio
"""

import sys
import requests
import json

def fetch_posts(user_id=None):
    try:
        # Define query parameters
        params = {}
        if user_id:
            params['userId'] = user_id

        # Make a GET request to fetch posts data with optional query parameters
        response = requests.get('https://jsonplaceholder.typicode.com/posts', params=params)

        # Check if the request was successful (status code 200)
        if response.status_code == 200:
            # Parse JSON response
            posts = response.json()
            return posts
        else:
            print("Error: Unable to fetch posts. Status code:", response.status_code)
            return None
    except Exception as e:
        print("An error occurred:", e)
        return None

def save_posts_to_file(posts, filename='posts.json'):
    try:
        # Write posts data to a JSON file
        with open(filename, 'w') as file:
            json.dump(posts, file, indent=4)
        print("Posts data saved to '{}' successfully.".format(filename))
    except Exception as e:
        print("An error occurred while saving posts data:", e)

def main():
    # Parse command line arguments
    if len(sys.argv) > 1:
        user_id = sys.argv[1]  # Extract user ID from command line argument
    else:
        user_id = None

    # Fetch posts data with optional user ID
    posts = fetch_posts(user_id=user_id)
    if posts:
        # Save posts data to a JSON file
        save_posts_to_file(posts)

if __name__ == "__main__":
    main()